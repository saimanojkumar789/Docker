# ğŸ³ Docker Swarm Cheat Sheet

---

## ğŸ“Œ Concepts

- **Compose** â†’ Create multiple services on a **single host** using `docker-compose.yml`  
- **Swarm** â†’ Create **single services** that can run on **multiple hosts**  
- **Stack** â†’ Deploy **multiple services** across **multiple hosts** using a stack file (`docker-compose.yml`)

---

## ğŸš€ Key Features

- **Self-healing** â†’ Automatically restarts failed containers to maintain desired state  
- **Scaling** â†’ Adjust the number of replicas dynamically  
- **High Availability** â†’ Services run on multiple nodes to ensure uptime  
- **Update & Rollback** â†’ Rolling updates with ability to revert to previous versions

---

## ğŸ›  Docker Swarm Commands

- **Initialize Swarm**  
  â†’ `docker swarm init` â†’ Initialize the current node as a **Swarm manager**

- **Manage nodes**  
  â†’ `docker node ls` â†’ List all nodes in the Swarm  
  â†’ `docker node rm <node-name>` â†’ Remove a node from the Swarm  

- **Create a service**  
  â†’ `docker service create --name <svcname> --replicas 3 --publish 1111:80 <image>`  (img must be from docker hub)
    â†’ Create a service with 3 replicas and publish host port 1111 â†’ container port 80

- **List services & tasks**  
  â†’ `docker service ls` â†’ List all services  
  â†’ `docker service ps <svcname>` â†’ Show all tasks (containers), including stopped/failed ones  
  â†’ `docker service ps <svcname> --filter "desired-state=running"` â†’ Show tasks Swarm wants running  
  â†’ `docker service ps <svcname> --filter "current-state=running"` â†’ Show **currently running tasks only**

- **Scale services**  
  â†’ `docker service scale <svcname>=3` â†’ scaling 

- **Update & rollback**  
  â†’ `docker service update <svcname> --image=<newimage>` â†’ Update service to a new image (rolling update)  
  â†’ `docker service rollback <svcname>` â†’ Rollback service to the previous version

- **Remove service**  
  â†’ `docker service rm <svcname>` â†’ Delete the service from Swarm

- **Swarm join tokens**  
  â†’ `docker swarm join-token worker` â†’ Get the command/token to add a worker node  
  â†’ `docker swarm join-token manager` â†’ Get the command/token to add a manager node

- **Leave Swarm**  
  â†’ `docker swarm leave` â†’ Node leaves Swarm gracefully  
  â†’ `docker swarm leave --force` â†’ Force a node to leave immediately

---

## ğŸ”§ Additional Useful Commands

- **Inspect services & nodes**  
  â†’ `docker service inspect <svcname>` â†’ Detailed info about service (VIP, networks, tasks)  
  â†’ `docker node inspect <node>` â†’ Inspect node configuration and role

- **View logs**  
  â†’ `docker service logs <svcname>` â†’ View logs for all tasks of a service

- **Networking**  
  â†’ `docker network ls` â†’ List overlay networks in Swarm  
  â†’ `docker network inspect <network>` â†’ Inspect a network and connected containers

---

## ğŸ’¡ Quick Tips for Interviews

- **Single-node Swarm** â†’ Can test scaling, service creation, self-healing  
- **Published ports** â†’ Only **one host port** maps to the service VIP, not per container  
- **Rolling updates** â†’ Updates containers **one by one**, zero downtime  
- **Self-healing example** â†’ Even `--replicas 1` will restart a failed container automatically  
- **Service vs Container** â†’ `docker service` = Swarm-level, `docker run` = single container

---

## âš¡ Example Commands

- Initialize Swarm  
  â†’ `docker swarm init`

- List nodes  
  â†’ `docker node ls`

- Create service with 3 replicas and publish port  
  â†’ `docker service create --name devops --replicas 3 --publish 1111:80 nginx`

- List services  
  â†’ `docker service ls`

- Show all tasks for a service  
  â†’ `docker service ps devops`

- Show only running tasks  
  â†’ `docker service ps devops --filter "current-state=running"`

- Scale service  
  â†’ `docker service scale devops=3`

- Remove service  
  â†’ `docker service rm devops`

- Update service  
  â†’ `docker service update devops --image nginx:latest`

- Rollback service  
  â†’ `docker service rollback devops`

- Get worker join token  
  â†’ `docker swarm join-token worker`

- Get manager join token  
  â†’ `docker swarm join-token manager`

- Leave Swarm  
  â†’ `docker swarm leave`  
  â†’ `docker swarm leave --force`

- Remove node  
  â†’ `docker node rm <node-name>`
